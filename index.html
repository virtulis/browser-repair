<!DOCTYPE html>
<html>
	<head>
		<title>Browser.Repair</title>
		<meta charset="utf-8">
	</head>
	<body>

		<h1>Browser.Repair</h1>

		<h2>Is it broken?</h2>
		<div id="checker" class="checker checker-unknown">
			<h3 id="checker_header">
				Unknown.
			</h3>
			<div id="checker_text">
				You seem to have JavaScript disabled.
				<a href="https://secure.browser.repair">Click here to check manually</a>. If you get an error, click “Back” and read on.
			</div>
		</div>

		<a href="/certs/ISG_Root_X1.der">Download (DER format)</a>
		<a href="/certs/ISG_Root_X1.pem">Download (PEM format)</a>

		<script type="text/javascript">

			var result = null;

			function setCheckerStatus(cls, header, text) {
				document.getElementById('checker').className = 'checker checker-' + cls;
				document.getElementById('checker_header').innerHTML = header;
				document.getElementById('checker_text').innerHTML = text;
			}
			setCheckerStatus(
				'checking',
				'Checking...',
				'Checking if your browser can handle certicates properly, it shouldn\'t take long'
			);

			function fail() {
				result = false;
				setCheckerStatus(
					'fail',
					'Yes, it\'s broken!',
					'Your device will have major problems connecting to websites. Read the instructions below on how to fix it.'
				);
			}

			setTimeout(function () {
				if (result === null) setCheckerStatus(
					'fail',
					'It\'s probably broken!',
					'The check never finished which is usually not a good sign. Try following the directions below.'
				);
			}, 3000);

			var script = document.createElement('script');
			script.src = 'https://' + location.hostname + '/check.js';
			script.onerror = fail;
			window.onerror = fail;
			document.body.appendChild(script);

		</script>

	</body>
</html>
